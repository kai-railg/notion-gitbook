# 7 复制（副本集）

- 什么是复制？

    复制提供了数据的冗余备份，并在多个服务器上存储数据副本，提高了数据的可用性，并可以保证数据的安全性，

    复制还允许从硬件故障和服务中断中恢复数据

- 复制的作用
    - 数据备份
    - 数据容灾恢复
    - 读写分离
    - 高（24*7）可用性
    - 无宕机维护
    - 副本集对应用程序是透明

- 复制的工作原理
    - 复制至少需要两个节点A、B
    - A是主节点，负责处理客户端请求
    - 其余的都是从节点，负责复制主节点的数据
    - 节点常见的搭配方式有：一主一从，一主多从
    - 主节点记录在其上的所有操作，从节点定期轮询主节点获取数据，然后对自己的数据副本执行这些操作，从而保证从节点的数据与主节点的一致
    - 主节点与从节点进行数据交互保证数据的一致性
- 复制的特点
    - N个节点的集群
    - 任何节点都可以作为主节点
    - 所有写入操作都在主节点上
    - 自动故障转移
    - 自动恢复
- 设置复制节点
    - 使用如下格式启动mongod，注意replSet的名称是一致的

        mongod --bind_ip 192.168.196.128 --port 27017 --dbpath ~/Desktop/t1 --replSet rs0

        mongod --bind_ip 192.168.196.128 --port 27018 --dbpath ~/Desktop/t2 --replSet rs0

    - 连接主服务器

        mongo --host 192.168.196.128 --port 27017

    - 初始化

        rs.initiate()

    - 查看状态

        rs.status()

    - 添加副本集

        rs.add('192.168.196.128:27018')

    - 设置从服务器可读

        rs.slaveOk()

    - 删除服务器

        rs.remove('192.168.196.128:27018')