# 误删数据的处理方法

- 传统的高可用是不能防止误删数据的，因为主库的drop table 命令，或通过binlog传给其他备库，进而导致整个集群都会执行这个命令
- 本文主要介绍误删数据的分类以及应对方法
- MySQL误删数据的分类
    - 使用delete 误删行
    - 使用 drop table 或 truncate table 误删表
    - 使用 drop database 误删库
    - 使用 rm  误删实例
- **误删行**
    - 可以使用 `flashback` 工具通过`闪回`把数据恢复回来
    - flashback 恢复数据的原理，是修改binlog的内容，拿回数据库重放。
        - 前提是需要开启 `binlog_format=row` 和 `binlog_row_image=FULL`
- **误删表/库**
    - 需要使用`全量备份+增量日志`的方式。这个方案要求线上有定期的全量备份，并且实时备份binlog
    - 在这两个条件都具备的情况下，恢复数据的流程如下
        - 去最近的一次全量备份
        - 用备份恢复出一个临时库
        - 从日志备份取出全量备份时间点之后的日志
        - 把这些日志，除了误删数据的语句外，全部用到临时库
- **延迟复制备库**
    - 如果有非常核心的业务，不允许太长的恢复时间，我们可以考虑搭建`延迟复制的备库`
    - 延迟复制的备库是一种特殊的备库，通过`CHANGE MASTER TO MASTER_DELAY = N`，可以设置跟主库保持N秒的延迟
- **rm 删除MySQL实例**
    - 因为WAL，可以用从库的binlog直接恢复，或者切换主备
-